package com.soltech.pages;

import java.io.IOException;

import org.apache.log4j.Logger;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.FindBy;
import org.openqa.selenium.support.PageFactory;

import com.soltech.base.CommonClass;

public class OpenPositionsPage extends CommonClass{
	
	WebDriver driver;		
	public static final Logger log = Logger.getLogger(OpenPositionsPage.class.getName());	
//	private String openPositionsPageTitle = "SOLTECH";
	
	@FindBy(css="a[href='https://careers-soltech.icims.com/jobs/2011/quality-assurance-automation-engineer/job?in_iframe=1']")
	WebElement qaPosition;	
	
	@FindBy(id="icims_content_iframe")
	WebElement iFrameId;
	
	@FindBy(id="jsb_f_keywords_i")
	WebElement jobKeywords;
	
	@FindBy(id="jsb_form_submit_i")
	WebElement jobSearchButton;		
	
	public OpenPositionsPage(WebDriver driver){
		this.driver=driver;
		PageFactory.initElements(driver, this);
	}	

	public boolean getPageTitle() throws IOException{
		if (driver.getPageSource().contains(getObject().getProperty("openPositionsPageTitle"))) return true;			
		return false;
	}
	
	public void switchToIframe(){
		driver.switchTo().frame(iFrameId);
	}
	
	private void scrollToDown(){
		JavascriptExecutor jse = (JavascriptExecutor) driver;
		jse.executeScript("scrollBy(0,2500)");
	}
	
	private void switchToNewWindow(){
		String parentWindow = driver.getWindowHandle();
		System.out.println("outside of for loop:"+parentWindow);
		for(String winHandle : driver.getWindowHandles()){
			 if(!winHandle.equals(parentWindow))
	          {
				 driver.switchTo().window(winHandle);
	          }
		}
	}
	
	public void enterForSearch() throws InterruptedException{
		log.info("============== Switching to iFrame ==================");	
		Thread.sleep(3000L);
		switchToNewWindow();
		switchToIframe();				
		scrollToDown();
		jobKeywords.sendKeys("QA");		
	}
	
	public void clickOnSearch(){
		log.info("============== Clicking on job search button  ==================");
		jobSearchButton.click();		
	}
	
	public JobDetailPage clikOnQAPositionFromSerachResults(){
		qaPosition.click();
		return new JobDetailPage(driver);
	}
}